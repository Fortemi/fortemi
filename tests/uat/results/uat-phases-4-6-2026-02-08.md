# Matric Memory UAT Report: Phases 4-6 (Tags, Collections, Links)
**Test Execution Date**: 2026-02-08  
**API Version**: 2026.2.7  
**Test Environment**: https://memory.integrolabs.net

## Executive Summary

| Metric | Value |
|--------|-------|
| Total Tests | 19 |
| Passed | 8 (42.1%) |
| Failed | 3 (15.8%) |
| Blocked | 8 (42.1%) |
| **Pass Rate (executed)** | **72.7%** (8/11) |
| **Pass Rate (total)** | **42.1%** (8/19) |
| Gitea Issues Filed | 4 (#190-#193) |

## Critical Findings

### 1. MCP Server Not Initialized (CRITICAL - Issue #190)

**Impact**: Blocks all Phase 6 (Links) tests - 31.6% of test suite

The MCP endpoint returns error on all tool calls:
```json
{
  "jsonrpc": "2.0",
  "error": {
    "code": -32000,
    "message": "Bad Request: Server not initialized"
  }
}
```

**New Requirements Identified**:
- OAuth bearer token now required (change from previous runs)
- Must include Accept headers: `application/json, text/event-stream`

**Blocked Tests**:
- LINK-001: get_note_links
- LINK-002: get_note_backlinks
- LINK-003: explore_graph (depth 1)
- LINK-004: explore_graph (depth 2)
- LINK-005: Link scores verification
- LINK-006: get_note_provenance

### 2. REST API Collection Operations Broken (HIGH)

**Issue #191**: `PUT /api/v1/notes/{id}/collection/{collection_id}` returns 404
- Cannot move notes to collections
- Core feature unavailable via REST API

**Issue #192**: `POST /api/v1/collections` with `parent_id` returns `null`
- Cannot create nested collections
- Collection hierarchy broken

## Phase-by-Phase Results

### Phase 4: Tags - 5 PASS, 1 FAIL (83.3%)

| Test | Status | Details |
|------|--------|---------|
| TAG-001 | ✓ PASS | Listed 30 tags successfully |
| TAG-002 | ✓ PASS | Added new tag `uat/new-tag` |
| TAG-003 | ✓ PASS | Verified tag hierarchy (count: 1) |
| TAG-004 | ✓ PASS | Removed tag successfully |
| TAG-005 | ✓ PASS | 5-level tag depth accepted |
| TAG-006 | ✗ FAIL | 6-level tag accepted (should error) - Issue #193 |

**Tag Tests Summary**: Tag CRUD operations work well. Only deficiency is missing validation for tag depth > 5 levels (edge case, low severity).

### Phase 5: Collections - 3 PASS, 2 FAIL, 2 BLOCKED (60% of executed)

| Test | Status | Details |
|------|--------|---------|
| COL-001 | ✓ PASS | Listed 3 collections |
| COL-002 | ✗ FAIL | Move note to collection - 404 error (Issue #191) |
| COL-003 | ✓ PASS | Found note in collection (from prior move) |
| COL-004 | ✗ FAIL | Nested collection created but parent_id null (Issue #192) |
| COL-005 | ⊗ BLOCKED | Depends on COL-004 |
| COL-006 | ⊗ BLOCKED | Depends on COL-004 |
| COL-007 | ✓ PASS | Duplicate name rejected (409 Conflict) |

**Collection Tests Summary**: Basic operations (list, create) work. Advanced operations (move, hierarchy) broken via REST API.

### Phase 6: Links - 0 PASS, 0 FAIL, 6 BLOCKED (100% blocked)

All 6 tests blocked due to MCP server initialization failure (Issue #190):

| Test | MCP Tool | Purpose |
|------|----------|---------|
| LINK-001 | get_note_links | Retrieve outgoing links |
| LINK-002 | get_note_backlinks | Retrieve incoming links |
| LINK-003 | explore_graph | 1-hop graph traversal |
| LINK-004 | explore_graph | 2-hop graph traversal |
| LINK-005 | - | Verify link scores (0-1, semantic > 0.7) |
| LINK-006 | get_note_provenance | Retrieve provenance chain |

## Detailed API Deficiencies

### Deficiency 1: Tag Depth Validation (Low Severity)
- **Test**: TAG-006
- **Issue**: #193
- **Endpoint**: `POST /api/v1/notes`
- **Problem**: Accepts tags with 6+ levels without validation/truncation
- **Expected**: Reject with 400 or truncate to 5 levels
- **Example**: Tag `uat/a/b/c/d/e/f` accepted in note `019c3e3f-7eb5-7b63-b25e-646dcc1ebf30`

### Deficiency 2: Move Note to Collection (High Severity)
- **Test**: COL-002
- **Issue**: #191
- **Endpoint**: `PUT /api/v1/notes/{id}/collection/{collection_id}`
- **Problem**: Returns 404 Not Found
- **Expected**: 200 OK, note's collection_id updated
- **Impact**: Cannot organize notes into collections via REST API

### Deficiency 3: Nested Collection Creation (High Severity)
- **Test**: COL-004
- **Issue**: #192
- **Endpoint**: `POST /api/v1/collections`
- **Problem**: `parent_id` in request ignored, response shows null
- **Expected**: Collection created with parent_id preserved
- **Impact**: Cannot create collection hierarchies via REST API
- **Example**: Collection `019c3e3f-7f8c-7df3-ad30-9126b8028bf0` created with null parent

### Deficiency 4: MCP Server Initialization (Critical Severity)
- **Tests**: All LINK-* tests (6 total)
- **Issue**: #190
- **Endpoint**: `https://memory.integrolabs.net/mcp`
- **Problem**: "Server not initialized" error on all tool calls
- **Expected**: MCP functional after OAuth authentication
- **Impact**: 31.6% of test suite blocked, all graph/link features unavailable

## Test Artifacts Created

### Notes
- `019c3e3f-3e2a-73b3-b76c-b2a6bb78dff0` - 5-level tag depth (valid)
- `019c3e3f-7eb5-7b63-b25e-646dcc1ebf30` - 6-level tag depth (invalid but accepted)

### Collections
- `019c3e3f-7f8c-7df3-ad30-9126b8028bf0` - Nested collection (parent_id null)

### OAuth Client
- `mm_DMk7lPn8NmEP6W5VSKOGJ2Hy` - UAT Test Client (client_credentials grant)

## Recommendations

### Immediate (Critical)
1. **Fix MCP Server Initialization** (Issue #190)
   - Investigate why MCP server reports not initialized
   - Verify OAuth token introspection for MCP endpoint
   - Test with both application/json and SSE accept headers
   - Priority: P0 (blocks 31.6% of tests)

### High Priority
2. **Fix Move Note to Collection** (Issue #191)
   - Implement or fix `PUT /api/v1/notes/{id}/collection/{collection_id}`
   - Ensure note's collection_id is updated
   - Return appropriate success response
   - Priority: P1 (core feature)

3. **Fix Nested Collection Creation** (Issue #192)
   - Honor `parent_id` parameter in POST body
   - Return collection with correct parent_id
   - Update collection hierarchy indices
   - Priority: P1 (core feature)

### Medium Priority
4. **Add Tag Depth Validation** (Issue #193)
   - Document maximum tag depth (if > 5 is allowed)
   - OR implement validation to reject/truncate at 5 levels
   - Priority: P2 (edge case, low user impact)

### Documentation
5. **Clarify REST vs MCP-Only Endpoints**
   - Document which features require MCP
   - Provide REST alternatives where possible
   - Update OpenAPI spec with endpoint availability

## Environment Details

- **API Base URL**: https://memory.integrolabs.net
- **API Version**: 2026.2.7 (reported by /health)
- **Test Framework**: Bash + curl + jq
- **Authentication**: OAuth 2.0 client_credentials grant
- **Test Date**: 2026-02-08 17:13-17:15 UTC
- **Previous Run**: 2026-02-07 (Phase 4: 11/11 PASS, Phase 5: 10/10 PASS, Phase 6: 13/13 PASS)

## Comparison to Previous Run (2026-02-07)

| Phase | Previous | Current | Change |
|-------|----------|---------|--------|
| Phase 4 (Tags) | 11/11 PASS | 5/6 PASS | -1 (TAG-006 new test) |
| Phase 5 (Collections) | 10/10 PASS | 3/7 executed | -2 (REST API regressions) |
| Phase 6 (Links) | 13/13 PASS | 0/6 executed | -13 (MCP server down) |

**Key Difference**: Previous run used MCP-first approach with working MCP server. This run attempted REST API first due to MCP failure, exposing REST API gaps.

## Conclusion

**Overall Assessment**: Significant regression from previous run (2026-02-07) due to MCP server failure.

**Strengths**:
- Tag operations work well via REST API
- Basic collection listing/creation functional
- Duplicate prevention working correctly

**Critical Issues**:
- MCP server completely unavailable (blocks 31.6% of tests)
- REST API incomplete for collection management
- No fallback path for MCP-only features

**Next Steps**:
1. Restore MCP server functionality (Issue #190)
2. Complete REST API for collection operations (Issues #191, #192)
3. Re-run Phase 6 tests once MCP is operational
4. Add regression tests for REST API collection endpoints

---

**Test Execution Summary**
- Test Script: `/tmp/phases-4-6-final.sh`
- Results JSON: `/mnt/dev-inbox/fortemi/fortemi/tests/uat/results/uat-phases-4-6-2026-02-08.json`
- Investigation Log: `/tmp/phases-4-6-output.log`
- Gitea Issues: #190 (MCP), #191 (move note), #192 (nested collection), #193 (tag depth)
